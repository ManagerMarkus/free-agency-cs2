<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Free Agency - CS2</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header">
    <h1>Free Agency - CS2 (Male)</h1>
    <a href="https://forms.gle/1FpgbMZUkupGmGUFNUVWguQ4sM6VUjVkh" target="_blank" class="btn submit">Submit Request</a>
  </div>
  <div class="filters">
    <select id="roleFilter">
      <option value="">Role</option>
      <option value="Player">Player</option>
      <option value="Coach">Coach</option>
      <option value="Organisation">Organisation</option>
    </select>
    <select id="regionFilter">
      <option value="">Region</option>
      <option value="EU">EU</option>
      <option value="NA">NA</option>
    </select>
    <select id="requestFilter">
      <option value="">Request</option>
      <option value="Looking For Team">Looking For Team</option>
      <option value="Looking For Players">Looking For Players</option>
      <option value="Looking For Coach">Looking For Coach</option>
    </select>
    <label><input type="checkbox" id="showArchived"> Show Archived</label>
  </div>
  <div id="loading">Loading entries...</div>
  <div id="cards"></div>

  <script>
    let data = [];
    async function loadData() {
      document.getElementById("loading").style.display = "block";
      const res = await fetch('https://script.google.com/macros/s/AKfycbzb5rEu6prDcf8VkUgStO6RTGEKNP9Jivzu7PI7wf89yNWJY9mX_XzlsapBiShHVlG5/exec');
      data = await res.json();
      renderCards(data);
      document.getElementById("loading").style.display = "none";
    }

    function renderCards(list) {
      const container = document.getElementById('cards');
      container.innerHTML = '';
      list.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <h3>${entry.name}</h3>
          <p>${entry.request}</p>
          <a href="${entry.twitter}" target="_blank" class="btn twitter">Twitter</a>
          <a href="${entry.moreInfo}" target="_blank" class="btn info">More Info</a>
        `;
        container.appendChild(card);
      });
    }

    function applyFilters() {
      const role = document.getElementById('roleFilter').value;
      const region = document.getElementById('regionFilter').value;
      const request = document.getElementById('requestFilter').value;
      const showArchived = document.getElementById('showArchived').checked;

      const filtered = data.filter(entry => {
        const isActive = entry.active && entry.active.toLowerCase() === "yes";
        return (!role || entry.role === role) &&
               (!region || entry.region === region) &&
               (!request || entry.request === request) &&
               (showArchived || isActive);
      });

      renderCards(filtered);
    }

    document.getElementById('roleFilter').addEventListener('change', applyFilters);
    document.getElementById('regionFilter').addEventListener('change', applyFilters);
    document.getElementById('requestFilter').addEventListener('change', applyFilters);
    document.getElementById('showArchived').addEventListener('change', applyFilters);

    loadData();
  </script>
</body>
</html>
