<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Free Agency - CS2 (Supabase)</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header">
    <h1>Free Agency - CS2 (Male)</h1>
    <a href="admin.html" target="_blank" class="btn submit">Submit Request</a>
  </div>
  <div class="filters">
    <button id="resetFilters" class="btn reset">Zur√ºcksetzen</button>
    <select id="roleFilter">
      <option value="">Role</option>
      <option value="Player">Player</option>
      <option value="Coach">Coach</option>
      <option value="Organisation">Organisation</option>
    </select>
    <select id="regionFilter">
      <option value="">Region</option>
      <option value="EU">EU</option>
      <option value="NA">NA</option>
    </select>
    <select id="requestFilter">
      <option value="">Request</option>
      <option value="Looking for team">Looking for team</option>
      <option value="Looking for players">Looking for players</option>
      <option value="Looking for coach">Looking for coach</option>
    </select>
    <label><input type="checkbox" id="showArchived"> Show Archived</label>
  </div>
  <div id="loading">Loading entries...</div>
  <div id="cards"></div>

  <script>
    const supabaseUrl = "https://naornmbibulaoglbfywk.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5hb3JubWJpYnVsYW9nbGJmeXdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDM5NDgwNDMsImV4cCI6MjA1OTUyNDA0M30.Y_1yKFRauVaRzbnq0LPrKJeeuL7Xt-y_gMirNBf03i8";
    let data = [];

    async function loadData() {
      document.getElementById("loading").style.display = "block";
      const res = await fetch(supabaseUrl + "/rest/v1/entries?select=*", {
        headers: {
          'apikey': supabaseKey,
          'Authorization': 'Bearer ' + supabaseKey
        }
      });
      data = await res.json();
      renderCards(data);
      document.getElementById("loading").style.display = "none";
    }

    function renderCards(list) {
      const container = document.getElementById('cards');
      container.innerHTML = '';
      list.forEach(entry => {
        const card = document.createElement('div');
        card.className = 'card';
        const archivedLabel = entry.active && entry.active.trim().toLowerCase() === "no" ? '<span class="archived">[Archiviert]</span>' : '';
        card.innerHTML = `
          <h3>\${entry.name}</h3>
          <p>\${entry.request} \${archivedLabel}</p>
          <a href="\${entry.twitter}" target="_blank" class="btn twitter">Twitter</a>
          <a href="\${entry.moreInfo}" target="_blank" class="btn info">More Info</a>
        `;
        container.appendChild(card);
      });
    }

    function applyFilters() {
      const role = document.getElementById('roleFilter').value;
      const region = document.getElementById('regionFilter').value;
      const request = document.getElementById('requestFilter').value;
      const showArchived = document.getElementById('showArchived').checked;

      const filtered = data.filter(entry => {
        const isActive = !entry.active || entry.active.trim().toLowerCase() === "yes";
        const matchesRole = !role || (entry.role && entry.role.trim() === role);
        const matchesRegion = !region || (entry.region && entry.region.trim() === region);
        const matchesRequest = !request || (entry.request && entry.request.trim() === request);
        return matchesRole && matchesRegion && matchesRequest && (showArchived || isActive);
      });

      renderCards(filtered);
    }

    document.getElementById('roleFilter').addEventListener('change', applyFilters);
    document.getElementById('regionFilter').addEventListener('change', applyFilters);
    document.getElementById('requestFilter').addEventListener('change', applyFilters);
    document.getElementById('showArchived').addEventListener('change', applyFilters);
    document.getElementById('resetFilters').addEventListener('click', () => {
      document.getElementById('roleFilter').value = '';
      document.getElementById('regionFilter').value = '';
      document.getElementById('requestFilter').value = '';
      document.getElementById('showArchived').checked = false;
      applyFilters();
    });

    loadData();
  </script>
</body>
</html>
